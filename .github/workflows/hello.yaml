name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "🖥️ The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "🍏 This job's status is ${{ job.status }}."
      - name: notify-slack
        run: |
          tag=$(git rev-parse --ref HEAD | cut -c -7)
          export MESSAGE="deployed ${tag} to maxtest-us"

          curl https://slack.com/api/chat.postMessage \
          -X POST --fail --silent --show-error \
          -H "Authorization: Bearer ${SLACK_TOKEN}" \
          -H "Content-type: application/json; charset=utf-8" \
          --data @<(yq -pjson -ojson '.channel = env(SLACK_CHANNEL) | .blocks[0].text.text = env(MESSAGE)' <<'EOF'
          {
            "channel": "",
            "blocks": [
              {
                "type": "section",
                "text": {
                  "type": "mrkdwn",
                  "text": ""
                }
              }
            ]
          }
          EOF
          ) >/dev/null
        env:
          SLACK_CHANNEL: "${{ secrets.SLACK_CHANNEL }}"
          SLACK_TOKEN: "${{ secrets.SLACK_TOKEN }}"
